<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Slack Pixel Art</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="header">
    <div class="header-content">
      <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <rect x="4" y="4" width="6" height="6" fill="currentColor" opacity="0.8"/>
          <rect x="14" y="4" width="6" height="6" fill="currentColor"/>
          <rect x="4" y="14" width="6" height="6" fill="currentColor"/>
          <rect x="14" y="14" width="6" height="6" fill="currentColor" opacity="0.6"/>
        </svg>
      </div>
      <h1>Slack Pixel Art</h1>
    </div>
  </div>
  
  <div class="container">
    <div class="card">
      <div class="card-header">
        <span class="step-badge">1</span>
        <h2>Extract Emojis</h2>
      </div>
      <div class="card-body">
        <p class="help-text">Enter your workspace's emoji page URL, open it, then extract emojis</p>
        
        <div class="input-group">
          <label for="emojiPageUrl">
            Emoji Page URL
          </label>
          <div class="input-with-button">
            <input type="text" id="emojiPageUrl" placeholder="https://your-workspace.slack.com/customize/emoji">
            <button id="openEmojiPage" class="btn btn-secondary" title="Open in new tab">Open</button>
          </div>
        </div>
        
        <!-- Cache Info -->
        <div id="cacheInfo" class="cache-info" style="display: none;">
          <div class="cache-stats">
            <span id="cacheCount">0 emojis cached</span>
            <span id="cacheDate" class="cache-date"></span>
          </div>
          <div class="cache-actions">
            <label class="checkbox-label">
              <input type="checkbox" id="autoSync" checked>
              <span>Auto-sync when new emojis detected</span>
            </label>
          </div>
        </div>
        
        <!-- Sync Alert -->
        <div id="syncAlert" class="sync-alert" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <path d="M8 4v4M8 10v1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span id="syncAlertText">New emojis available!</span>
        </div>
        
        <div class="extract-buttons">
          <button id="extractEmojis" class="btn btn-primary">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span id="extractBtnText">Sync Emojis</span>
          </button>
        </div>
        
        <!-- Extraction Progress -->
        <div id="extractProgress" class="extract-progress" style="display: none;">
          <div class="progress-header">
            <span id="progressPhase">Fetching emojis...</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress-bar">
            <div id="extractProgressBar" class="progress-fill"></div>
          </div>
          <div id="progressDetails" class="progress-details">Starting...</div>
        </div>
        
        <div id="emojiStatus" class="status"></div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <span class="step-badge">2</span>
        <h2>Load Image</h2>
      </div>
      <div class="card-body">
        <div class="input-group">
          <label for="imageUrl">Image URL</label>
          <div class="input-with-button">
            <input type="text" id="imageUrl" placeholder="https://example.com/image.png">
            <button id="loadFromUrl" class="btn btn-secondary">Load</button>
          </div>
        </div>
        <div class="divider">
          <span>or</span>
        </div>
        <div class="input-group">
          <label for="imageFile">Upload File</label>
          <div class="file-input-wrapper">
            <input type="file" id="imageFile" accept="image/*">
            <span class="file-input-label">Choose an image file</span>
          </div>
        </div>
        <div id="imageStatus" class="status"></div>
      </div>
    </div>
    
    <div class="card">
      <details class="collapsible-card">
        <summary class="card-header collapsible-header">
          <span class="step-badge">3</span>
          <h2>Advanced Image Controls</h2>
          <svg class="collapse-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </summary>
        <div class="card-body">
        <div class="config-grid">
          <div class="input-group">
            <label for="width">
              Width
              <span class="label-hint">(emojis)</span>
            </label>
            <input type="number" id="width" value="20" min="5" max="100">
          </div>
          <div class="input-group">
            <label for="height">
              Height
              <span class="label-hint">(emojis)</span>
            </label>
            <input type="number" id="height" value="20" min="5" max="100">
          </div>
        </div>
        <div class="input-group">
          <label for="charBudget">
            Character Budget
            <span class="label-hint">(0 = unlimited)</span>
          </label>
          <input type="number" id="charBudget" value="4000" min="0" max="40000">
        </div>
        <div class="input-group">
          <label for="tolerance">
            Duplicate Tolerance
            <span class="label-hint">(0-100)</span>
          </label>
          <input type="range" id="toleranceRange" min="0" max="100" value="10" aria-label="Duplicate tolerance">
          <div class="range-value">
            <input type="number" id="tolerance" value="10" min="0" max="100">
          </div>
          <small>Lower values require more unique emojis</small>
        </div>

        <div class="input-group">
          <label class="checkbox-label">
            <input type="checkbox" id="dithering" checked>
            <span>Dithering (better quality, slightly slower)</span>
          </label>
          <small>Helps gradients and subtle shading look closer to the source image</small>
        </div>

        <div class="input-group">
          <label for="ditherStrength">
            Dithering Strength
            <span class="label-hint">(0-100)</span>
          </label>
          <input type="range" id="ditherStrengthRange" min="0" max="100" value="85" aria-label="Dithering strength">
          <div class="range-value">
            <input type="number" id="ditherStrength" value="85" min="0" max="100">
          </div>
          <small>Lower = smoother, higher = more detail/texture</small>
        </div>

        <div class="input-group">
          <label for="texturePenalty">
            Prefer Solid Emojis
            <span class="label-hint">(0-100)</span>
          </label>
          <input type="range" id="texturePenaltyRange" min="0" max="100" value="55" aria-label="Prefer solid emojis">
          <div class="range-value">
            <input type="number" id="texturePenalty" value="55" min="0" max="100">
          </div>
          <small>Higher values avoid busy/outlined emojis for better photo-like results</small>
        </div>

        <div class="input-group">
          <label for="rasterSamples">
            Raster Quality
            <span class="label-hint">(1-5)</span>
          </label>
          <input type="range" id="rasterSamplesRange" min="1" max="5" value="3" aria-label="Raster quality">
          <div class="range-value">
            <input type="number" id="rasterSamples" value="3" min="1" max="5">
          </div>
          <small>Higher values sample more from the source image for better color matching</small>
        </div>

        <div class="input-group">
          <label class="checkbox-label">
            <input type="checkbox" id="lanczosInterpolation" checked>
            <span>Lanczos3 Interpolation (higher quality)</span>
          </label>
          <small>Superior resampling algorithm for sharper details, slightly slower than bilinear</small>
        </div>

        <div class="input-group">
          <label class="checkbox-label">
            <input type="checkbox" id="adaptiveSampling" checked>
            <span>Adaptive Supersampling (edge detection)</span>
          </label>
          <small>Uses more samples in high-detail regions for better edge quality</small>
        </div>

        <div class="input-group">
          <label class="checkbox-label">
            <input type="checkbox" id="adaptiveDithering" checked>
            <span>Adaptive Dithering (texture-aware)</span>
          </label>
          <small>Reduces dithering in detailed areas, increases in smooth gradients</small>
        </div>

        <div class="input-group">
          <label for="sharpeningStrength">
            Sharpening Strength
            <span class="label-hint">(0-100)</span>
          </label>
          <input type="range" id="sharpeningStrengthRange" min="0" max="100" value="0" aria-label="Sharpening strength">
          <div class="range-value">
            <input type="number" id="sharpeningStrength" value="0" min="0" max="100">
          </div>
          <small>Enhances edges and fine details (0 = off, 50-70 recommended)</small>
        </div>
      </div>
      </details>
    </div>
    
    <div class="card">
      <div class="card-header">
        <span class="step-badge">4</span>
        <h2>Generate</h2>
      </div>
      <div class="card-body">
        <button id="generate" class="btn btn-primary btn-large" disabled>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-label="Generate icon">
            <path d="M8 2L2 8l6 6 6-6-6-6z" fill="currentColor"/>
          </svg>
          Generate Pixel Art
        </button>
        <div id="generateStatus" class="status"></div>
        <div id="progress" class="progress-bar" style="display: none;">
          <div id="progressBar" class="progress-fill"></div>
        </div>
      </div>
    </div>
    
    <div class="card" id="previewSection" style="display: none;">
      <div class="card-header">
        <span class="step-badge">âœ“</span>
        <h2>Preview</h2>
      </div>
      <div class="card-body">
        <!-- Preview Tabs -->
        <div class="preview-tabs">
          <button id="visualTabBtn" class="preview-tab active">Visual</button>
          <button id="textTabBtn" class="preview-tab">Text</button>
        </div>
        
        <!-- Comparison Controls -->
        <div class="comparison-controls" id="comparisonControls" style="display:none;">
          <label>Compare:</label>
          <button id="sideBySideBtn" class="compare-btn active">Side by Side</button>
          <button id="overlayBtn" class="compare-btn">Overlay</button>
          <input type="range" id="overlayOpacity" min="0" max="100" value="50" style="display:none;">
        </div>

        <!-- Visual Preview (emoji images) -->
        <div id="visualPreview" class="visual-preview"></div>
        
        <!-- Text Preview -->
        <div id="preview" class="preview" style="display: none;"></div>
        
        <div class="stats-card">
          <div id="stats" class="stats"></div>
        </div>
        <div class="action-buttons">
          <button id="copyToClipboard" class="btn btn-success">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-label="Copy icon">
              <rect x="4" y="4" width="8" height="10" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <path d="M6 4V3a1 1 0 011-1h6a1 1 0 011 1v8a1 1 0 01-1 1h-1" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            Copy to Clipboard
          </button>
          <button id="downloadText" class="btn btn-secondary">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-label="Download icon">
              <path d="M8 2v8m0 0l3-3m-3 3L5 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M2 11v2a1 1 0 001 1h10a1 1 0 001-1v-2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Download
          </button>
        </div>
        <div id="copyStatus" class="status"></div>
      </div>
    </div>
  </div>
  
  <script src="pixelart.js"></script>
  <script src="popup.js"></script>
</body>
</html>
